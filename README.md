# Apocryph / Trusted Pods

**NOTE**: This repository used to host the code recently moved to https://github.com/comrade-coop/apocryph-chain as part of a repository overhaul and reorganization. With due apologies to any past Github stargazers, we hope they would find this new and more active project well worth their star.

Meanwhile, the main body of code was moved here from https://github.com/comrade-coop/trusted-pods (now gone), and parts of the documentation/code might still refer to the old location. Use `git remote set-url origin git://github.com/comrade-coop/apocryph` (or `git remote set-url origin git@github.com:comrade-coop/apocryph.git`) to update your local clone/s to point to the right repository.

See [this issue](https://github.com/comrade-coop/apocryph/issues/14) for more details.

---

Apocryph is a decentralised three-sided compute marketplace, allowing end-users to deploy their own personal instance of "cloud" software and developers to train AI/ML models or deploy arbitrary software applications to pre-verified machines in the marketplace. All programs would run inside a secure computing enclave that no one else can access (using TEE technology) for a modest fee (however much the machine provider charges; it's a marketplace) and with regular uptime and data storage SLAs; "cloud" software developers are being rewarded for providing the software (essentially use cases) to the marketplace with a fraction of the fees generated by the instances of their software.

[![Discord](https://img.shields.io/badge/DISCORD-COMMUNITY-informational?style=for-the-badge&logo=discord)](https://discord.gg/C4e37Xhvt4)

:notebook: For more information you can check our documentation (specs) draft:
- [GitHub Pages](https://comrade-coop.github.io/apocryph)
- [GitHub Markdown](spec/SUMMARY.md)

## Spinning up a local testing environment
### Required Dependencies

Before running the various tests or setting up the local testing environment, Make sure the following dependencies are installed and available in your PATH:

- **curl**: A command-line tool for transferring data with URL syntax.
- **xargs**: A command that builds and executes command lines from standard input.
- **sed**: A stream editor for filtering and transforming text.
- **go**: The Go programming language compiler.
- **kubectl**: The Kubernetes command-line tool for managing Kubernetes clusters.
- **docker**: A platform for developing, shipping, and running applications using containerization.
- **[jq](https://jqlang.github.io/jq/)**: A lightweight and flexible command-line JSON processor.
- **[minikube](https://minikube.sigs.k8s.io/docs/start/)**: A tool that runs a single-node Kubernetes cluster on your personal computer (locally).
- **[helmfile](https://github.com/helmfile/helmfile)**: A declarative configuration tool for Helm.
- **[forge, cast, anvil](https://github.com/foundry-rs/foundry)**: tools for building Ethereum-based applications.
- **[ipfs](https://docs.ipfs.tech/install/ipfs-desktop/)**: The InterPlanetary File System
- **[constellation](https://docs.edgeless.systems/constellation/getting-started/first-steps-local)**: A platform for secure data exchange in distributed systems, particularly in blockchain networks (Needed in `test/e2e/constellation`).

### E2E Tests
To start a local environment for e.g. integration-testing or evaluating the project, you can use the end-to-end tests in the `test/e2e` folder.

Typical development involves running the minikube end-to-end test, which can be done using the following command:

```bash
test/e2e/minikube/run-test.sh
```

The command will report any missing dependencies; for a full list of the required packages.

The command, once all dependencies are met, will proceed to start a local docker registry and test ethereum node, build and upload the project to them, then spin up a minikube cluster and deploy all necessary prerequisites into it, and finally deploying a pod from a [manifest file](spec/MANIFEST.md) into the cluster and then querying it over HTTP. It should display the curl command used to query the pod, and you should be able to use it yourself after the script is finished.

In addition, once you have started the minikube end-to-end test, you can also run the web UI test, which presents a sample interface that publishers can use to deploy a predefined pod template onto the minikube cluster / provider directly from their web browser.

```bash
turbo dev
```

Once you are done playing around with the tests, simply run the following command to delete and stop the minikube cluster:

```bash
test/e2e/minikube/run-test.sh teardown
```

(or alternatively, pass `teardown full` to also stop any local docker containers used by the test)

## Development

Install Turbo (If you haven't already) using your favorite package manager , Ex: `npm i -g turbo`

#### Syncing Generated Files

After editing files in `proto/` or `contracts/`, run the following command to sync the generated files:

```sh
turbo sync
```

#### Build Images

The following will build the apocryph trusted pods server and the p2p-helper images

```sh
turbo build-images
```

  <!-- Note that while committing generated files is foreign to Nodejs/NPM, it's the usual way of life in the Go ecosystem, as packages are directly cloned from git rather than downloaded from the package manager. Here we are committing both in order to not require forge/protoc for JavaScript development when it's optional for Go development. -->

## Contributing

As it is, this project is still in its infancy, and most non-trivial contributions should be done only after discussing them with the team -- or else risk missing the point. So, if you fancy contributing to the project, please feel free to hop on [our Discord server](https://discord.gg/C4e37Xhvt4) or just open/reply to an issue discussing your concrete ideas for contribution.

Also, see the [`PUBLISHING.md`](spec/PUBLISHING.md) documentation for more details on the overall structure of the project.

## License

[SPDX-License-Identifier: GPL-3.0](./LICENSE.md)
