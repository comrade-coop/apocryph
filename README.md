# Apocryph / Trusted Pods

**NOTE**: This repository used to host the code recently moved to https://github.com/comrade-coop/apocryph-chain as part of a repository overhaul and reorganization. With due apologies to any past Github stargazers, we hope they would find this new and more active project well worth their star.

Meanwhile, the main body of code was moved here from https://github.com/comrade-coop/trusted-pods (now gone), and parts of the documentation/code might still refer to the old location. Use `git remote set-url origin git://github.com/comrade-coop/apocryph` (or `git remote set-url origin git@github.com:comrade-coop/apocryph.git`) to update your local clone/s to point to the right repository.

See [this issue](https://github.com/comrade-coop/apocryph/issues/14) for more details.

---

Apocryph is a decentralised three-sided compute marketplace, allowing end-users to deploy their own personal instance of "cloud" software and developers to train AI/ML models or deploy arbitrary software applications to pre-verified machines in the marketplace. All programs would run inside a secure computing enclave that no one else can access (using TEE technology) for a modest fee (however much the machine provider charges; it's a marketplace) and with regular uptime and data storage SLAs; "cloud" software developers are being rewarded for providing the software (essentially use cases) to the marketplace with a fraction of the fees generated by the instances of their software.

[![Discord](https://img.shields.io/badge/DISCORD-COMMUNITY-informational?style=for-the-badge&logo=discord)](https://discord.gg/fWwMSZdBF2)

:notebook: For more information you can check our documentation (specs) draft:
- [GitHub Pages](https://comrade-coop.github.io/apocryph)
- [GitHub Markdown](spec/SUMMARY.md)

## Spinning up a local testing environment
> __Note__
The following tests have been conducted on Linux.

### Dependencies

Before running the various tests, Make sure the following dependencies are installed and available in your PATH:

- **curl**: tool for transferring data using various network protocols. The name stands for "Client for URL"
- **xargs**: command that builds and executes command lines from standard input.
- **sed**: stream editor for filtering and transforming text.
- **[go](https://go.dev/doc/install)**: The Go programming language compiler.
- **[protoc](https://grpc.io/docs/protoc-installation/)**: The protocol buffer compiler, protoc, is used to compile .proto files, which contain service and message definitions.
- **[protoc-gen-go](https://grpc.io/docs/languages/go/quickstart/)**: tool used in conjunction with protobuf to generate Go code from protobuf definition files
- **protoc-gen-connect-go**: generates Go code from protobuf files specifically tailored for the Connect RPC. `go install connectrpc.com/connect/cmd/protoc-gen-connect-go@latest`
- **abigen**: convert Ethereum ABI definitions into easy to use, type-safe Go packages. `go install github.com/ethereum/go-ethereum/cmd/abigen@latest`
- **[turbo](https://turbo.build/repo/docs/installing)**: High-performance build system
- **[kubectl](https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/)**: The Kubernetes command-line tool for managing Kubernetes clusters.
- **[docker](https://docs.docker.com/engine/install/)**: platform for developing, shipping, and running applications using containerization.
- **[jq](https://jqlang.github.io/jq/)**: lightweight and flexible command-line JSON processor.
- **[kind](https://kind.sigs.k8s.io/docs/user/quick-start/)**: tool that runs a single-node Kubernetes cluster locally.
- **[ctlptl](https://github.com/tilt-dev/ctlptl/)**: An utility for declaratively setting up local Kubernetes clusters.
- **[tilt](https://docs.tilt.dev/install.html)**: A toolkit automating the process of setting up a new local development cluster.
- **[helm](https://helm.sh/)**: package manager for Kubernetes 
- **[helmfile](https://github.com/helmfile/helmfile)**: declarative configuration tool for Helm.
- **[forge, cast, anvil](https://github.com/foundry-rs/foundry)**: tools for building Ethereum-based applications. <!-- TODO: Move to container -->
- **[ipfs](https://docs.ipfs.tech/install/command-line/#install-official-binary-distributions)**: The InterPlanetary File System
- **[constellation](https://docs.edgeless.systems/constellation/getting-started/first-steps-local)**: Constellation is a Kubernetes engine that provides a secure and confidential way to run Kubernetes clusters. (Needed in `test/e2e/constellation`).

Clone and cd into the project:
```bash
git clone https://github.com/comrade-coop/apocryph
cd apocryph
```
Run the following commands to complete all necessary build steps and generate the required files for running the tests.

```bash
npm i && turbo sync 
```
> Rerun `turbo sync` whenever you change files under the `proto/` and `contracts/` folders.

To start a local environment for e.g. integration-testing or evaluating the project, you can use `tilt` with Tiltfile in the `test/e2e` folder.

You can use it, for example, by running the following commands:

```bash
# Create a kind cluster:
ctlptl create cluster kind --registry=ctlptl-registry --kubernetes-version=v1.31.0
# Start tilt and run the nginx test:
tilt up -- --include ./test/e2e/nginx/Tiltfile
```

The first command will spin up a kind cluster with a local registry. Then, the second command will, after checking that any additional dependencies are met, then deploy all necessary prerequisites into local cluster, and finally deploying a pod from a [manifest file](spec/MANIFEST.md) into the cluster. <!-- TODO and then querying it over HTTP. It should display the curl command used to query the pod, and you should be able to use it yourself after the script is finished. -->

<!-- TODO
In addition, once you have started the minikube end-to-end test, you can also run the web UI test, which presents a sample interface that publishers can use to deploy a predefined pod template onto the minikube cluster / provider directly from their web browser.

```bash
turbo dev
``` -->

Once you are done playing around with the test, run the following commands to clean up:

```bash
# Clean up the local cluster:
tilt down -- --include ./test/e2e/nginx/Tiltfile
# Delete up the local cluster:
ctlptl create delete kind
```

  <!-- Note that while committing generated files is foreign to Nodejs/NPM, it's the usual way of life in the Go ecosystem, as packages are directly cloned from git rather than downloaded from the package manager. Here we are committing both in order to not require forge/protoc for JavaScript development when it's optional for Go development. -->

## Contributing

As it is, this project is still in its infancy, and most non-trivial contributions should be done only after discussing them with the team -- or else risk missing the point. So, if you fancy contributing to the project, please feel free to hop on [our Discord server](https:///fWwMSZdBF2) or just open/reply to an issue discussing your concrete ideas for contribution.

Also, see the [`PUBLISHING.md`](spec/PUBLISHING.md) documentation for more details on the overall structure of the project.

## License

[SPDX-License-Identifier: GPL-3.0](./LICENSE.md)
